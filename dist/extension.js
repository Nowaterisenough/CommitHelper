"use strict";var R=Object.create;var $=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var _=(e,o)=>{for(var t in o)$(e,t,{get:o[t],enumerable:!0})},A=(e,o,t,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of O(o))!N.call(e,n)&&n!==t&&$(e,n,{get:()=>o[n],enumerable:!(r=L(o,n))||r.enumerable});return e};var y=(e,o,t)=>(t=e!=null?R(S(e)):{},A(o||!e||!e.__esModule?$(t,"default",{value:e,enumerable:!0}):t,e)),B=e=>A($({},"__esModule",{value:!0}),e);var tt={};_(tt,{activate:()=>X,deactivate:()=>Y});module.exports=B(tt);var l=y(require("vscode")),D=y(require("https")),K=y(require("http")),I=require("url");var w=class{constructor(o=5){this.cache=new Map;this.ttl=o*60*1e3}set(o,t){this.cache.set(o,{data:t,timestamp:Date.now()})}get(o){let t=this.cache.get(o);if(t){if(Date.now()-t.timestamp>this.ttl){this.cache.delete(o);return}return t.data}}clear(){this.cache.clear()}};var T,k=new w(5),C=new w(10),U,d={debug:!1,maxIssues:100,requestTimeout:1e4};function s(e,o){if(!d.debug&&!e.includes("\u9519\u8BEF"))return;let r=`[${new Date().toISOString()}] ${e}`;o!==void 0&&(r+=`
${JSON.stringify(o,null,2)}`),T.appendLine(r),console.log(r)}function q(e,o={}){return new Promise((t,r)=>{let n=new I.URL(e),i=n.protocol==="https:",c=i?D:K,a={hostname:n.hostname,port:n.port||(i?443:80),path:n.pathname+n.search,method:o.method||"GET",headers:o.headers||{},timeout:o.timeout||1e4};s("\u53D1\u8D77HTTP\u8BF7\u6C42",{url:e.replace(/token=[^&]+/,"token=***").replace(/Bearer [^,}]+/,"Bearer ***"),method:a.method,hostname:a.hostname,port:a.port});let g=c.request(a,p=>{let m="";p.on("data",u=>{m+=u}),p.on("end",()=>{if(s("HTTP\u54CD\u5E94",{statusCode:p.statusCode,statusMessage:p.statusMessage,headers:p.headers}),!p.statusCode||p.statusCode<200||p.statusCode>=300){r(new Error(`HTTP ${p.statusCode}: ${p.statusMessage}
${m}`));return}try{let u=JSON.parse(m);t(u)}catch(u){s("JSON\u89E3\u6790\u5931\u8D25",{data:m.substring(0,200)}),r(new Error(`JSON\u89E3\u6790\u5931\u8D25: ${u}`))}})});g.on("error",p=>{s("HTTP\u8BF7\u6C42\u9519\u8BEF",{error:p.message}),r(p)}),g.on("timeout",()=>{g.destroy(),r(new Error("\u8BF7\u6C42\u8D85\u65F6"))}),g.end()})}async function J(e,o={},t=2){for(let r=0;r<=t;r++)try{return await q(e,o)}catch(n){if(r===t)throw n;await new Promise(i=>setTimeout(i,1e3*(r+1)))}}async function v(e,o){let t=l.workspace.getConfiguration("commitHelper");switch(s("\u83B7\u53D6\u8BBF\u95EE\u4EE4\u724C",{platform:e,hostUrl:o}),e){case"github":let r=t.get("githubToken")||process.env.GITHUB_TOKEN;return s(`GitHub Token: ${r?"\u5DF2\u914D\u7F6E":"\u672A\u914D\u7F6E"}`),r;case"gitlab":let n=t.get("gitlabToken")||process.env.GITLAB_TOKEN;return s(`GitLab Token: ${n?"\u5DF2\u914D\u7F6E":"\u672A\u914D\u7F6E"}`),n;case"local-gitlab":let i=t.get("localGitlabToken")||process.env.LOCAL_GITLAB_TOKEN;if(i||(i=t.get("gitlabToken")||process.env.GITLAB_TOKEN),!i&&o)try{let a=new I.URL(o).hostname,g=[`gitlabToken.${a}`,`localGitlabToken.${a}`,`gitlab.${a}.token`,`tokens.${a}`];s("\u5C1D\u8BD5\u67E5\u627E\u4E3B\u673A\u7279\u5B9A\u914D\u7F6E",{hostname:a,configKeys:g});for(let p of g){let m=l.workspace.getConfiguration(),u=`commitHelper.${p}`;if(i=m.get(u),s(`\u68C0\u67E5\u914D\u7F6E\u952E: ${u}`,{found:!!i}),i){s(`\u4F7F\u7528\u914D\u7F6E\u952E\u83B7\u53D6\u5230Token: ${u}`);break}}}catch(a){s(`\u89E3\u6790hostUrl\u5931\u8D25: ${a}`)}return s(`\u672C\u5730GitLab Token: ${i?"\u5DF2\u914D\u7F6E":"\u672A\u914D\u7F6E"}`,{hasLocalToken:!!(t.get("localGitlabToken")||process.env.LOCAL_GITLAB_TOKEN),hasGitlabToken:!!(t.get("gitlabToken")||process.env.GITLAB_TOKEN),hostUrl:o,tokenPrefix:i?i.substring(0,8)+"...":"none"}),i;case"gitee":let c=t.get("giteeToken")||process.env.GITEE_TOKEN;return s(`Gitee Token: ${c?"\u5DF2\u914D\u7F6E":"\u672A\u914D\u7F6E"}`),c;default:return}}function x(e){s("\u89E3\u6790Git URL",{url:e});let o=e.match(/^(https?:\/\/([^\/]+))\/([^\/]+)\/(.+?)(?:\.git)?$/);if(o){let t=o[1],r=o[2],n=o[3],i=o[4];return s("HTTPS\u683C\u5F0F\u5339\u914D\u6210\u529F",{fullHostUrl:t,hostname:r,owner:n,repo:i}),r.includes("github.com")?{platform:"github",owner:n,repo:i,baseUrl:"https://api.github.com",hostUrl:t}:r.includes("gitlab.com")?{platform:"gitlab",owner:n,repo:i,baseUrl:"https://gitlab.com/api/v4",hostUrl:t}:r.includes("gitee.com")?{platform:"gitee",owner:n,repo:i,baseUrl:"https://gitee.com/api/v5",hostUrl:t}:{platform:"local-gitlab",owner:n,repo:i,baseUrl:`${t}/api/v4`,hostUrl:t}}if(o=e.match(/^ssh:\/\/git@([^:\/]+):(\d+)\/([^\/]+)\/(.+?)(?:\.git)?$/),o){let t=o[1],r=o[2],n=o[3],i=o[4];if(s("SSH\u683C\u5F0F\uFF08\u5E26\u7AEF\u53E3\uFF09\u5339\u914D\u6210\u529F",{hostname:t,port:r,owner:n,repo:i}),t.includes("github.com"))return{platform:"github",owner:n,repo:i,baseUrl:"https://api.github.com",hostUrl:`https://${t}`};if(t.includes("gitlab.com"))return{platform:"gitlab",owner:n,repo:i,baseUrl:"https://gitlab.com/api/v4",hostUrl:`https://${t}`};if(t.includes("gitee.com"))return{platform:"gitee",owner:n,repo:i,baseUrl:"https://gitee.com/api/v5",hostUrl:`https://${t}`};{let a=t.match(/^192\.168\./)||t.match(/^10\./)||t.match(/^172\.(1[6-9]|2[0-9]|3[0-1])\./)||t==="localhost"?"http":"https",g=r==="2222"?"":`:${r}`,p=`${a}://${t}${g}`;return s("\u672C\u5730GitLab\u914D\u7F6E",{protocol:a,webPort:g,hostUrl:p}),{platform:"local-gitlab",owner:n,repo:i,baseUrl:`${p}/api/v4`,hostUrl:p}}}if(o=e.match(/^git@([^:]+):([^\/]+)\/(.+?)(?:\.git)?$/),o){let t=o[1],r=o[2],n=o[3];if(s("SSH\u683C\u5F0F\uFF08\u6807\u51C6\uFF09\u5339\u914D\u6210\u529F",{hostname:t,owner:r,repo:n}),t.includes("github.com"))return{platform:"github",owner:r,repo:n,baseUrl:"https://api.github.com",hostUrl:`https://${t}`};if(t.includes("gitlab.com"))return{platform:"gitlab",owner:r,repo:n,baseUrl:"https://gitlab.com/api/v4",hostUrl:`https://${t}`};if(t.includes("gitee.com"))return{platform:"gitee",owner:r,repo:n,baseUrl:"https://gitee.com/api/v5",hostUrl:`https://${t}`};{let a=`${t.match(/^192\.168\./)||t.match(/^10\./)||t.match(/^172\.(1[6-9]|2[0-9]|3[0-1])\./)||t==="localhost"?"http":"https"}://${t}`;return{platform:"local-gitlab",owner:r,repo:n,baseUrl:`${a}/api/v4`,hostUrl:a}}}if(o=e.match(/^ssh:\/\/git@([^\/]+)\/([^\/]+)\/(.+?)(?:\.git)?$/),o){let t=o[1],r=o[2],n=o[3];if(s("SSH\u683C\u5F0F\uFF08\u65E0\u7AEF\u53E3\uFF09\u5339\u914D\u6210\u529F",{hostname:t,owner:r,repo:n}),t.includes("github.com"))return{platform:"github",owner:r,repo:n,baseUrl:"https://api.github.com",hostUrl:`https://${t}`};if(t.includes("gitlab.com"))return{platform:"gitlab",owner:r,repo:n,baseUrl:"https://gitlab.com/api/v4",hostUrl:`https://${t}`};if(t.includes("gitee.com"))return{platform:"gitee",owner:r,repo:n,baseUrl:"https://gitee.com/api/v5",hostUrl:`https://${t}`};{let a=`${t.match(/^192\.168\./)||t.match(/^10\./)||t.match(/^172\.(1[6-9]|2[0-9]|3[0-1])\./)||t==="localhost"?"http":"https"}://${t}`;return{platform:"local-gitlab",owner:r,repo:n,baseUrl:`${a}/api/v4`,hostUrl:a}}}return s("Git URL\u89E3\u6790\u5931\u8D25 - \u5C1D\u8BD5\u6240\u6709\u6A21\u5F0F",{url:e,patterns:["https://host/owner/repo.git","ssh://git@host:port/owner/repo.git","git@host:owner/repo.git","ssh://git@host/owner/repo.git"]}),null}function G(){if(!U){let e=l.extensions.getExtension("vscode.git")?.exports;e&&(U=e.getAPI(1))}return U}async function P(){let e="current-repo",o=C.get(e);if(o)return s("\u4F7F\u7528\u7F13\u5B58\u7684\u4ED3\u5E93\u4FE1\u606F"),o;try{let t=G();if(!t||t.repositories.length===0)return s("\u672A\u627E\u5230Git\u4ED3\u5E93"),null;let n=t.repositories[0].state.remotes;if(n.length===0)return s("\u672A\u627E\u5230\u8FDC\u7A0B\u4ED3\u5E93"),null;let i=n.find(g=>g.name==="origin")||n[0],c=i.fetchUrl||i.pushUrl;s("\u83B7\u53D6\u5230\u8FDC\u7A0BURL",{remoteName:i.name,fetchUrl:c});let a=x(c);return a&&(C.set(e,a),s("\u4ED3\u5E93\u4FE1\u606F\u5DF2\u7F13\u5B58",a)),a}catch(t){return s("\u83B7\u53D6\u4ED3\u5E93\u4FE1\u606F\u5931\u8D25",{error:String(t)}),null}}function E(e){return e.replace(/^(?:\[[^\]]+\]|【[^】]+】|\([^)]+\)|[A-Z]+[-:])\s*-?\s*/,"").trim()||e}function j(e,o){let t,r={};switch(e.platform){case"github":t=`https://api.github.com/repos/${e.owner}/${e.repo}/issues?state=open&per_page=${d.maxIssues}`,r={Authorization:`token ${o}`,Accept:"application/vnd.github.v3+json","User-Agent":"VSCode-CommitHelper"};break;case"gitlab":case"local-gitlab":let n=e.repo.replace(/\.git$/,""),i=encodeURIComponent(`${e.owner}/${n}`);t=`${e.baseUrl}/projects/${i}/issues?state=opened&per_page=${d.maxIssues}`,r={Authorization:`Bearer ${o}`,"Content-Type":"application/json"},s("GitLab API\u8C03\u7528\u8BE6\u60C5",{cleanRepo:n,projectPath:i,apiUrl:t.replace(o,"***"),headers:{...r,Authorization:"Bearer ***"}});break;case"gitee":t=`https://gitee.com/api/v5/repos/${e.owner}/${e.repo}/issues?state=open&access_token=${o}&per_page=${d.maxIssues}`,r={Accept:"application/json","User-Agent":"VSCode-CommitHelper"};break;default:throw new Error(`\u4E0D\u652F\u6301\u7684\u5E73\u53F0: ${e.platform}`)}return{apiUrl:t,headers:r}}async function M(e){let o=`${e.platform}-${e.owner}-${e.repo}`,t=k.get(o);if(t)return s("\u4F7F\u7528\u7F13\u5B58\u7684\u8BAE\u9898\u6570\u636E",{count:t.length}),t;let r=await v(e.platform,e.hostUrl);if(s("\u5F00\u59CB\u83B7\u53D6\u8BAE\u9898",{platform:e.platform,baseUrl:e.baseUrl,owner:e.owner,repo:e.repo,hasToken:!!r,tokenPrefix:r?r.substring(0,8)+"...":"none"}),!r){let n=`\u672A\u627E\u5230 ${e.platform} \u7684\u8BBF\u95EE\u4EE4\u724C`;return s(n),l.window.showErrorMessage(n),[]}try{let{apiUrl:n,headers:i}=j(e,r),c=await J(n,{method:"GET",headers:i,timeout:d.requestTimeout});if(s("API\u54CD\u5E94\u6570\u636E",{type:Array.isArray(c)?"array":typeof c,length:Array.isArray(c)?c.length:"N/A",firstIssue:Array.isArray(c)&&c.length>0?{id:c[0].id||c[0].iid,title:c[0].title?.substring(0,50)+"...",state:c[0].state}:"none"}),!Array.isArray(c))throw s("API\u8FD4\u56DE\u6570\u636E\u683C\u5F0F\u9519\u8BEF",{actualType:typeof c,data:c}),new Error(`API\u8FD4\u56DE\u7684\u4E0D\u662F\u6570\u7EC4\u683C\u5F0F: ${typeof c}`);let a=c.map(g=>({id:g.id||g.iid,title:g.title,number:g.number||g.iid,state:g.state,url:g.html_url||g.web_url}));return k.set(o,a),s("\u8BAE\u9898\u83B7\u53D6\u6210\u529F\u5E76\u5DF2\u7F13\u5B58",{totalCount:a.length,issues:a.slice(0,3).map(g=>({number:g.number,title:g.title.substring(0,30)+"..."}))}),a}catch(n){let i=`\u83B7\u53D6\u8BAE\u9898\u5931\u8D25: ${n.message}`;return s(i,{error:n.toString(),stack:n.stack?.substring(0,500)}),l.window.showErrorMessage(i),[]}}async function z(){s("\u5F00\u59CB\u683C\u5F0F\u5316\u63D0\u4EA4\u6D88\u606F");try{let[e,o]=await Promise.all([P(),Promise.resolve(G())]);if(!e||!o){l.window.showErrorMessage("\u65E0\u6CD5\u83B7\u53D6\u4ED3\u5E93\u4FE1\u606F\uFF0C\u8BF7\u786E\u4FDD\u5728Git\u4ED3\u5E93\u4E2D\u6253\u5F00\u9879\u76EE");return}s("\u4ED3\u5E93\u4FE1\u606F\u83B7\u53D6\u6210\u529F",e);let t=o.repositories[0],r=t.inputBox.value||"";s("\u5F53\u524D\u63D0\u4EA4\u6D88\u606F",{currentMessage:r});let n=r.trim().length>0,i="",c=await l.window.withProgress({location:l.ProgressLocation.Notification,title:"\u6B63\u5728\u83B7\u53D6\u8BAE\u9898\u5217\u8868...",cancellable:!0},async(h,f)=>{s("\u83B7\u53D6\u8BAE\u9898\u5217\u8868\u4EE5\u4F9B\u7ED1\u5B9A\u9009\u62E9");let b=await M(e);return f.isCancellationRequested?[]:b});if(!c)return;s("\u83B7\u53D6\u5230\u7684\u6240\u6709\u8BAE\u9898",{count:c.length,issues:c.map(h=>({number:h.number,originalTitle:h.title,cleanedTitle:E(h.title).substring(0,50)+"..."}))});let a=[];if(c.length>0){let h=[{label:"$(x) \u4E0D\u7ED1\u5B9A\u8BAE\u9898",description:"\u672C\u6B21\u63D0\u4EA4\u4E0D\u5173\u8054\u4EFB\u4F55\u8BAE\u9898",issue:null},...c.map(b=>{let H=E(b.title);return{label:`$(issue-opened) #${b.number}`,description:H,detail:`\u539F\u6807\u9898: ${b.title}`,issue:{...b,title:H}}})],f=await l.window.showQuickPick(h,{placeHolder:n?"\u9009\u62E9\u8981\u7ED1\u5B9A\u7684\u8BAE\u9898\uFF08\u5F53\u524D\u5DF2\u6709\u63D0\u4EA4\u5185\u5BB9\uFF0C\u5C06\u4FDD\u7559\u73B0\u6709\u5185\u5BB9\uFF09":"\u9009\u62E9\u8981\u7ED1\u5B9A\u7684\u8BAE\u9898\u6216\u4E0D\u7ED1\u5B9A\u8BAE\u9898",matchOnDescription:!0,matchOnDetail:!0});if(f===void 0){s("\u7528\u6237\u53D6\u6D88\u4E86\u8BAE\u9898\u9009\u62E9");return}f.issue?(a=[f.issue],s("\u7528\u6237\u9009\u62E9\u7ED1\u5B9A\u8BAE\u9898",{issueNumber:f.issue.number,originalTitle:c.find(b=>b.number===f.issue.number)?.title,cleanedTitle:f.issue.title})):s("\u7528\u6237\u9009\u62E9\u4E0D\u7ED1\u5B9A\u8BAE\u9898")}else s("\u6CA1\u6709\u627E\u5230\u53EF\u7528\u7684\u8BAE\u9898");if(n)i=r.replace(/^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+?\))?\s*:\s*/,"").trim(),i||(i=r.trim()),s("\u4F7F\u7528\u73B0\u6709\u63D0\u4EA4\u6D88\u606F\u5185\u5BB9",{extractedTitle:i});else if(a.length>0)i=a[0].title,s("\u4F7F\u7528\u8BAE\u9898\u6807\u9898",{title:i});else{let h=await l.window.showInputBox({prompt:"\u8F93\u5165\u63D0\u4EA4\u63CF\u8FF0",placeHolder:"\u7B80\u8981\u63CF\u8FF0\u672C\u6B21\u63D0\u4EA4\u7684\u5185\u5BB9"});if(!h||!h.trim()){s("\u7528\u6237\u672A\u8F93\u5165\u63D0\u4EA4\u63CF\u8FF0");return}i=h.trim(),s("\u7528\u6237\u624B\u52A8\u8F93\u5165\u7684\u6807\u9898",{title:i})}let g=[{label:"feat",description:"\u65B0\u529F\u80FD"},{label:"fix",description:"\u4FEE\u590Dbug"},{label:"docs",description:"\u6587\u6863\u66F4\u65B0"},{label:"style",description:"\u4EE3\u7801\u683C\u5F0F\uFF08\u4E0D\u5F71\u54CD\u529F\u80FD\uFF09"},{label:"refactor",description:"\u91CD\u6784\uFF08\u65E2\u4E0D\u662F\u65B0\u529F\u80FD\u4E5F\u4E0D\u662F\u4FEE\u590Dbug\uFF09"},{label:"test",description:"\u6DFB\u52A0\u6216\u4FEE\u6539\u6D4B\u8BD5"},{label:"chore",description:"\u6784\u5EFA\u8FC7\u7A0B\u6216\u8F85\u52A9\u5DE5\u5177\u7684\u53D8\u52A8"},{label:"perf",description:"\u6027\u80FD\u4F18\u5316"},{label:"ci",description:"\u6301\u7EED\u96C6\u6210\u76F8\u5173"},{label:"build",description:"\u6784\u5EFA\u76F8\u5173"},{label:"revert",description:"\u56DE\u6EDA\u63D0\u4EA4"}],p=await l.window.showQuickPick(g,{placeHolder:"\u9009\u62E9\u63D0\u4EA4\u7C7B\u578B"});if(!p){s("\u7528\u6237\u672A\u9009\u62E9\u63D0\u4EA4\u7C7B\u578B");return}s("\u7528\u6237\u9009\u62E9\u7684\u63D0\u4EA4\u7C7B\u578B",{type:p.label});let m=await l.window.showInputBox({prompt:"\u8F93\u5165\u4F5C\u7528\u57DF\uFF08\u53EF\u9009\uFF09",placeHolder:"\u4F8B\u5982\uFF1Aapi, ui, auth"});s("\u7528\u6237\u8F93\u5165\u7684\u4F5C\u7528\u57DF",{scope:m||"\u65E0"});let u=p.label;m&&m.trim()&&(u+=`(${m.trim()})`),u+=`: ${i}`,a.length>0&&(u+=`

Closes #${a[0].number}`),t.inputBox.value=u,s("\u63D0\u4EA4\u6D88\u606F\u751F\u6210\u5B8C\u6210",{commitMessage:u,hadExistingContent:n,usedExistingTitle:n,boundIssue:a.length>0?a[0].number:null}),l.window.showInformationMessage(a.length>0?`\u63D0\u4EA4\u6D88\u606F\u5DF2\u751F\u6210\u5E76\u7ED1\u5B9A\u8BAE\u9898 #${a[0].number}\uFF01`:"\u63D0\u4EA4\u6D88\u606F\u5DF2\u751F\u6210\uFF01")}catch(e){let o=`\u683C\u5F0F\u5316\u63D0\u4EA4\u6D88\u606F\u5931\u8D25: ${e.message}`;s(o,{error:e.toString()}),l.window.showErrorMessage(o)}}async function Q(){s("=== \u5F00\u59CB\u6D4B\u8BD5\u914D\u7F6E ===");try{let e=await P();if(!e){l.window.showErrorMessage("\u65E0\u6CD5\u83B7\u53D6\u4ED3\u5E93\u4FE1\u606F");return}s("\u4ED3\u5E93\u4FE1\u606F",e);let o=await v(e.platform,e.hostUrl);if(!o){l.window.showErrorMessage(`\u672A\u627E\u5230 ${e.platform} \u7684\u8BBF\u95EE\u4EE4\u724C`);return}s("Token\u83B7\u53D6\u6210\u529F",{platform:e.platform,tokenPrefix:o.substring(0,8)+"..."});let t=await M(e);l.window.showInformationMessage(`\u914D\u7F6E\u6D4B\u8BD5\u5B8C\u6210\uFF01\u627E\u5230 ${t.length} \u4E2A\u8BAE\u9898\u3002\u8BE6\u60C5\u8BF7\u67E5\u770B\u8F93\u51FA\u9762\u677F\u3002`)}catch(e){let o=`\u914D\u7F6E\u6D4B\u8BD5\u5931\u8D25: ${e.message}`;s(o,{error:e.toString()}),l.window.showErrorMessage(o)}}async function V(){let e=l.workspace.getConfiguration("commitHelper"),o=l.workspace.getConfiguration();s("=== \u914D\u7F6E\u8C03\u8BD5\u4FE1\u606F ==="),s("CommitHelper\u914D\u7F6E:",{localGitlabToken:e.get("localGitlabToken")?"\u5DF2\u914D\u7F6E":"\u672A\u914D\u7F6E",gitlabToken:e.get("gitlabToken")?"\u5DF2\u914D\u7F6E":"\u672A\u914D\u7F6E",githubToken:e.get("githubToken")?"\u5DF2\u914D\u7F6E":"\u672A\u914D\u7F6E",giteeToken:e.get("giteeToken")?"\u5DF2\u914D\u7F6E":"\u672A\u914D\u7F6E"});let t=o.get("commitHelper.gitlabToken.192.168.110.213");s("IP\u7279\u5B9A\u914D\u7F6E:",{"commitHelper.gitlabToken.192.168.110.213":t?"\u5DF2\u914D\u7F6E":"\u672A\u914D\u7F6E",value:t?t.substring(0,8)+"...":"none"});let r=await P();if(r){s("\u4ED3\u5E93\u4FE1\u606F:",r);let n=await v(r.platform,r.hostUrl);s("\u6700\u7EC8\u83B7\u53D6\u7684Token:",n?n.substring(0,8)+"...":"none")}l.window.showInformationMessage("\u914D\u7F6E\u8C03\u8BD5\u4FE1\u606F\u5DF2\u8F93\u51FA\u5230CommitHelper\u9891\u9053")}async function W(){try{s("=== Git\u4ED3\u5E93\u8C03\u8BD5\u4FE1\u606F ===");let e=l.extensions.getExtension("vscode.git")?.exports;if(!e){s("Git\u6269\u5C55\u672A\u627E\u5230");return}let o=e.getAPI(1);if(o.repositories.length===0){s("\u672A\u627E\u5230Git\u4ED3\u5E93");return}let r=o.repositories[0].state.remotes;s("\u6240\u6709\u8FDC\u7A0B\u4ED3\u5E93:",r.map(a=>({name:a.name,fetchUrl:a.fetchUrl,pushUrl:a.pushUrl})));let n=r.find(a=>a.name==="origin")||r[0],i=n.fetchUrl||n.pushUrl;s("\u4F7F\u7528\u7684\u8FDC\u7A0BURL:",i);let c=x(i);if(s("\u89E3\u6790\u7ED3\u679C:",c),c){let a=await v(c.platform,c.hostUrl);s("Token\u83B7\u53D6\u7ED3\u679C:",{platform:c.platform,hasToken:!!a,tokenPrefix:a?a.substring(0,8)+"...":"none"})}l.window.showInformationMessage("\u8C03\u8BD5\u4FE1\u606F\u5DF2\u8F93\u51FA\u5230CommitHelper\u9891\u9053")}catch(e){s("\u8C03\u8BD5\u5931\u8D25:",e)}}async function Z(){k.clear(),C.clear(),s("\u7F13\u5B58\u5DF2\u6E05\u9664"),l.window.showInformationMessage("\u7F13\u5B58\u5DF2\u6E05\u9664")}async function F(){d.debug=!d.debug,s(`\u8C03\u8BD5\u6A21\u5F0F: ${d.debug?"\u5F00\u542F":"\u5173\u95ED"}`),l.window.showInformationMessage(`\u8C03\u8BD5\u6A21\u5F0F: ${d.debug?"\u5F00\u542F":"\u5173\u95ED"}`)}function X(e){T=l.window.createOutputChannel("CommitHelper"),s("CommitHelper \u63D2\u4EF6\u5DF2\u6FC0\u6D3B");let o=l.commands.registerCommand("CommitHelper.formatMessage",z),t=l.commands.registerCommand("CommitHelper.testConfig",Q),r=l.commands.registerCommand("CommitHelper.debugConfig",V),n=l.commands.registerCommand("CommitHelper.debugRepo",W),i=l.commands.registerCommand("CommitHelper.clearCache",Z),c=l.commands.registerCommand("CommitHelper.toggleDebug",F);e.subscriptions.push(o,t,r,n,i,c,T)}function Y(){T&&T.dispose()}0&&(module.exports={activate,deactivate});
